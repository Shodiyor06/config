{% extends 'base.html' %}
{% load static %}

{% block title %}Kirish - O'quv Markazi{% endblock %}

{% block content %}
<section class="auth-section">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <i class="fas fa-graduation-cap auth-icon"></i>
                <h2>Xush Kelibsiz</h2>
                <p>Platformaga kirish uchun ma'lumotlaringizni kiriting</p>
            </div>
            
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="phone">
                        <i class="fas fa-phone"></i>
                        Telefon raqam
                    </label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        placeholder="+998 90 123 45 67"
                        required
                        class="form-input"
                    >
                </div>
                
                <div class="form-group">
                    <label for="password">
                        <i class="fas fa-lock"></i>
                        Parol
                    </label>
                    <div class="password-input">
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            placeholder="Parolingizni kiriting"
                            required
                            class="form-input"
                        >
                        <button type="button" class="password-toggle" onclick="togglePassword()">
                            <i class="fas fa-eye" id="toggleIcon"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="remember">
                        <span>Eslab qolish</span>
                    </label>
                    <a href="#" class="forgot-link">Parolni unutdingizmi?</a>
                </div>
                
                <div class="alert alert-error" id="errorMessage" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="errorText"></span>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block btn-lg" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Kirish</span>
                    <div class="spinner" style="display: none;"></div>
                </button>
            </form>
            
            <div class="auth-footer">
                <p>Hali ro'yxatdan o'tmaganmisiz? <a href="#" class="register-link">Ro'yxatdan o'tish</a></p>
            </div>
        </div>
        
        <div class="auth-info">
            <div class="info-content">
                <h3>Platformamizda nima bor?</h3>
                <ul class="info-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Professional ustozlar</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Real loyihalarda amaliyot</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Interaktiv darslar</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Uy vazifalari tizimi</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>Sertifikat olish</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function togglePassword() {
    const passwordInput = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    }
}

document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const phone = document.getElementById('phone').value;
    const password = document.getElementById('password').value;

    try {
        const response = await fetch('/login/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ phone, password })
        });

        const data = await response.json();

        if (!response.ok) {
            alert(data.error || 'Login yoki parol noto‘g‘ri');
            return;
        }

        // ✅ ROLE BO‘YICHA REDIRECT
        if (data.role === 'STUDENT') {
            window.location.href = '/student/';
        } else if (data.role === 'TEACHER') {
            window.location.href = '/teacher/';
        } else {
            window.location.href = '/admin/';
        }

    } catch (err) {
        alert('Server bilan bog‘lanib bo‘lmadi');
    }
});

</script>
{% endblock %}
<script src="{% static 'js/auth.js' %}"></script>
